<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Family Tree of Nguyễn's Family</title>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet" />
<style>
body {
  font-family: Arial, sans-serif;
  
  padding: 20px;
  
}
#tree {
  font-size: 14px;
}
.member-group {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 6px;
}
.member {
  background-image: url('background-profile.jpg');
  background-size: 140px 100%; /* match member width and full height */
  background-position: center;
  background-repeat: repeat-x;  /* repeat horizontally */
  background-color: #f3edf1; 
  position: relative;
  overflow: hidden;
  border-radius: 8px;
  padding: 8px;
  width: 140px;
  text-align: center;
  color: #051677;
  text-shadow: 5px 3px 5px rgba(233, 229, 8, 0.863);
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  font-weight: bold;
}

.member img {
  background: rgba(255,255,255,0.6); /* adds contrast to make the image pop */
  padding: 4px;
  border-radius: 50%;
}

.member:hover {
  transform: scale(1.05);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}
.member::after {
  content: "";
  position: absolute;
  top: 0; left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
  transform: skewX(-20deg);
}
.member:hover::after {
  animation: shine 1.2s ease forwards;
}

img {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  object-fit: cover;
  object-position: center top; /* <-- shift image focus to top center */
  margin-bottom: 6px;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
img:hover {
  transform: scale(1.1);
}
img::after {
  content: "";
  position: absolute;
  top: 0; left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
  transform: skewX(-20deg);
}
img:hover::after {
  animation: shine 1.2s ease forwards;
}

@keyframes shine {
  0%   { left: -100%; }
  100% { left: 100%; }
}

strong, small {
  display: block;
  margin-bottom: 6px;
  user-select: text;
}
strong[contenteditable]:focus,
small[contenteditable]:focus {
  outline: 2px solid #0077cc;
  border-radius: 4px;
}

button {
  margin: 2px;
  padding: 4px 8px;
  border: none;
  border-radius: 4px;
  background: #0077cc;
  color: white;
  cursor: pointer;
  font-size: 0.8rem;
  position: relative;
  overflow: hidden;
}
button:hover {
  background: #005fa3;
}
button::after {
  content: "";
  position: absolute;
  top: 0; left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
  transform: skewX(-20deg);
}
button:hover::after {
  animation: shine 1.2s ease forwards;
}

a, .spouse-profile span {
  color: #0077cc;
  text-decoration: underline;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}
a:hover, .spouse-profile span:hover {
  color: #ff9900;
}
a::after, .spouse-profile span::after {
  content: "";
  position: absolute;
  top: 0; left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
  transform: skewX(-20deg);
}
a:hover::after, .spouse-profile span:hover::after {
  animation: shine 1.2s ease forwards;
}

.children {/*connection dot line relationship*/
  position: relative;
  margin-left: 30px;
  padding-left: 100px;
  border-left: 4px dashed  #1229ac;
}
  .children .children {
  border-left: 3px dashed #0a0; /* Generation 2 → Green */
}
.children .children .children {
  border-left: 3px dashed rgb(247, 34, 6); /* Generation 3 → Blue */
}
.children .children .children .children {
  border-left: 3px dashed #f804ec; /* Generation 4 → e */
}
.children .children .children .children .children {
  border-left: 3px dashed #07e2ff; /* Generation 5 →   */
}
.children .children .children .children .children .children {
  border-left: 3px dashed #d40cee; /* Generation 5 →   */
}
.children::before {
  content: '';
  position: absolute;
  left: 0;
  top: 16px;
  width: 20px;
  height: 2px;
  background: #bbb;
}
.spouse {
  border-color: #f48fb1;
}
.spouse-profile {
  display: flex;
  align-items: center;
  gap: 8px;
  background: #eee;
  padding: 4px 8px;
  border-radius: 8px;
  transition: background 0.3s ease;
  position: relative;
  overflow: hidden;
}
.spouse-profile:hover {
  background: #afbaf7;
}
.spouse-profile img {
  width: 50px;
  height: 50px;
  object-fit: cover;
  border-radius: 50%;
  transition: transform 0.3s ease;
}
.spouse-profile img:hover {
  transform: scale(1.15);
}

.couple-children {
  margin-top: 6px;
}
.blur {
  filter: blur(5px);
  pointer-events: none; /* Disable clicks */
  user-select: none; /* Prevent text selection */
}

/* Modal styles */
#profileModal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0; top: 0;
  width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
  color: #4e0823;
  font-weight: bold;
  font-family: 'Vollkorn', serif;  /* for Vietnamese style if you like */
}
#profileModal, #profileModal * {
  color: #4e0823 !important;
  font-weight: bold !important;
  font-family: 'Vollkorn', serif !important;
}
#profileModal .modal-content {
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
#profileModal.active {
  display: flex;
}
#profileContent {
  background: white;
  border-radius: 10px;
  max-width: 400px;
  width: 90%;
  padding: 20px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  position: relative;
}
#profileContent img {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  object-fit: cover;
  margin-bottom: 10px;
  display: block;
  margin-left: auto;
  margin-right: auto;
  transition: transform 0.3s ease;
  position: relative;
  overflow: hidden;
}
#profileContent img:hover {
  transform: scale(1.1);
}
#profileContent img::after {
  content: "";
  position: absolute;
  top: 0; left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
  transform: skewX(-20deg);
}
#profileContent img:hover::after {
  animation: shine 1.2s ease forwards;
}
#profileContent h2 {
  text-align: center;
  margin: 0 0 10px 0;
}
#profileContent .label {
  font-weight: bold;
  margin-top: 10px;
}
#profileContent .value {
  margin-bottom: 6px;
}
#profileContent textarea {
  width: 100%;
  min-height: 60px;
  resize: vertical;
  font-family: Arial, sans-serif;
  margin-bottom: 10px;
}
#profileCloseBtn {
  position: absolute;
  right: 12px;
  top: 12px;
  background: #d32f2f;
  color: white;
  border: none;
  border-radius: 50%;
  width: 28px;
  height: 28px;
  font-weight: bold;
  cursor: pointer;
  overflow: hidden;
}
#profileCloseBtn:hover {
  background: #a12020;
}
#profileCloseBtn::after {
  content: "";
  position: absolute;
  top: 0; left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
  transform: skewX(-20deg);
}
#profileCloseBtn:hover::after {
  animation: shine 1.2s ease forwards;
}
.profile-list {
  max-height: 100px;
  overflow-y: auto;
  border: 1px solid #ddd;
  padding: 6px;
  border-radius: 4px;
  background: #fafafa;
}

body::before {
  content: "";
  position: relative; /* change from fixed */
  top: 0;
  left: 0;
  width: 100%;
  height: 100%; /* cover full document height */
  min-height: 100vh;
  background: url('background.jpg') no-repeat center center;
  background-size: cover;
  background-attachment: fixed;  
  z-index: -1;
  pointer-events: none;
 
}

@import url('https://fonts.googleapis.com/css2?family=Roboto&family=Vollkorn&display=swap');

/* Header bar */
#mainHeader {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 60px;
  /*background: rgba(238, 250, 73, 0.95);*/
  background: linear-gradient(to right, #f06363, #d8bb3a);
  border-bottom: 1px solid #171641;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  font-family: 'Roboto', sans-serif;
  z-index: 1001;
  box-shadow: 0 2px 5px rgba(235, 215, 41, 0.1);
  user-select: none;
}

/* Left info (time + weather) */
#mainHeader .left-info {
  display: flex;
  gap: 15px;
  font-size: 0.9rem;
  font-weight: bold;
  color: #502ee9;
}
.left-info span {
  margin-right: 10px;
}

/* Center title */
#mainHeader h1 {
    position: absolute;
      left: 50%;
      transform: translateX(-50%);
      margin: 0;
      font-family: 'Great Vibes', cursive;
      font-weight: 400;
      font-size: 3rem;
      color: #090de9;
      user-select: text;
      pointer-events: none;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      text-shadow:
    3px 3px 5px rgba(223, 17, 51, 0.7),
    0 0 15px rgba(60, 157, 226, 0.8),
    0 0 25px rgba(0, 119, 204, 0.6);
}

/* Right info empty for now, can add social icons or other stuff later */
#mainHeader .right-info {
  width: 50px;
}
body {
  margin: 0;
  padding: 0 20px 20px 20px; /* keep your side and bottom padding */
  min-height: 100vh;
  font-family: Arial, sans-serif;
  
  background: url('background.jpg') no-repeat center top;
  background-size: contain;
  background-attachment: scroll;
  background-color: #f9f9f9; /* fallback background */
  color: #333;
}

/* profile when clicking profile image */
#profileContent {
  background: rgba(255, 255, 255, 0.85); /* semi-transparent white overlay */
  border-radius: 10px;
  max-width: 400px;
  width: 90%;
  padding: 20px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  position: relative;
  background-image: url('background.jpg');
  background-size: cover;
  background-position: center;
  color: #333;
}
</style>
</head>
<body>
    
    <header id="mainHeader">
        <div class="left-info">
          <span id="time"></span>
          <span id="date"></span>
          <span id="weather">🌤️ 25°C Melbourne</span>
        </div>
        <h1>Family Tree of Nguyễn's Family</h1>
        <div class="right-info"></div> <!-- empty for now -->
      </header>

    
<div id="tree"></div>
<button onclick="addRootMember()">Add Root Member</button>
<button onclick="clearTree()">Clear Tree</button>
<button id="adminBtn" style="position: fixed; top: 10px; right: 10px; z-index: 9999;">
  Admin Login
</button>



<!-- Profile Modal -->
<div id="profileModal" role="dialog" aria-modal="true" aria-labelledby="profileTitle">
  <div id="profileContent">
    <button id="profileCloseBtn" aria-label="Close Profile">&times;</button>
    <img id="profileImg" src="" alt="Profile Photo" />
    <h2 id="profileName"></h2>
    <div>
      <label for="profileBorn">Born:</label>
      <input type="text" id="profileBorn" placeholder="Enter birth year or date" />
    </div>
    <div>
      <span class="label">About:</span>
      <textarea id="profileDesc" rows="3"></textarea>
    </div>
    <div>
      <span class="label">Awards:</span>
      <textarea id="profileAwards" rows="2" placeholder="Enter awards, separated by commas"></textarea>
    </div>
    <div>
      <span class="label">Spouse(s):</span>
      <div id="profileSpouses" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
    </div>
    <div>
      <span class="label">Children:</span>
      <div id="profileChildren" class="profile-list"></div>
    </div>
  </div>
</div>
<script>
(() => {
  const STORAGE_KEY = 'familyTreeConnectors';
  let family = [];
  let couples = [];

  // To store awards by member id
  let awardsMap = {};

  // Save/load including awards
  function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({ family, couples, awardsMap }));
  }
  function load() {
    const data = localStorage.getItem(STORAGE_KEY);
    if (data) {
      const parsed = JSON.parse(data);
      family = parsed.family || [];
      couples = parsed.couples || [];
      awardsMap = parsed.awardsMap || {};
    }
  }
  function generateId() {
    return '_' + Math.random().toString(36).substr(2, 9);
  }
  function findMember(id) {
    return family.find(m => m.id === id);
  }
  function findCouple(id) {
    return couples.find(c => c.id === id);
  }
  function getRoots() {
    return family.filter(m => !m.parentCoupleId && !m.spouseOf);
  }
  function render() {
    const tree = document.getElementById('tree');
    tree.innerHTML = '';
    getRoots().forEach(root => {
      tree.appendChild(renderMemberWithCouples(root));
    });
  }
  function renderMemberWithCouples(member) {
    const container = document.createElement('div');
    const memberCouples = couples.filter(c => c.partner1Id === member.id || c.partner2Id === member.id);

    const groupDiv = document.createElement('div');
    groupDiv.className = 'member-group';
    groupDiv.appendChild(createMemberBox(member, false));

    memberCouples.forEach(couple => {
      const spouseId = couple.partner1Id === member.id ? couple.partner2Id : couple.partner1Id;
      const spouse = findMember(spouseId);
      if (spouse) groupDiv.appendChild(createMemberBox(spouse, true));
    });

    container.appendChild(groupDiv);

    memberCouples.forEach(couple => {
      const childrenDiv = document.createElement('div');
      childrenDiv.className = 'children couple-children';
      couple.childrenIds.forEach(childId => {
        const child = findMember(childId);
        if (child) childrenDiv.appendChild(renderMemberWithCouples(child));
      });
      container.appendChild(childrenDiv);
    });
    return container;
  }
  function createMemberBox(member, isSpouse) {
    const div = document.createElement('div');
    div.className = 'member';
    if (isSpouse) div.classList.add('spouse');
    div.innerHTML = `
      <img src="${member.img || 'https://via.placeholder.com/80?text=No+Image'}" alt="Profile image of ${member.name}" />
      <strong contenteditable="true">${member.name || 'Unnamed'}</strong>
     <div class="born-year">${member.born ? `Born: ${member.born}` : ''}</div>
      <small contenteditable="true">${member.desc || ''}</small>
      <div>
        <button title="Add child">Child</button>
        ${!isSpouse ? '<button title="Add spouse">Spouse</button>' : ''}
        ${member.parentCoupleId ? '<button title="Add sibling">Sibling</button>' : ''}
        <button title="Remove" style="background:#d32f2f">Remove</button>
      </div>
    `;
    // Clicking on the box (not buttons) opens profile modal
    div.addEventListener('click', e => {
      if (e.target.tagName !== 'BUTTON' && e.target.tagName !== 'STRONG' && e.target.tagName !== 'SMALL' && e.target.tagName !== 'IMG') {
        // Do nothing if clicked on container but not actual profile parts
        return;
      }
      if (e.target.tagName === 'BUTTON') return; // buttons have separate handlers
      e.stopPropagation();
      openProfileModal(member.id);
    });
    div.querySelector('img').onclick = e => {
      e.stopPropagation();
      if (!window.isAdmin) {//only admin can change URL
      alert('Only admins can change the image URL.');
      return;
    }
      const url = prompt('Enter image URL:', member.img || '');
      if (url !== null) {
        member.img = url.trim();
        save();
        render();
      }
    };
    div.querySelector('strong').onblur = e => {
      member.name = e.target.innerText.trim() || 'Unnamed';
      save();
      render();
    };
    div.querySelector('small').onblur = e => {
      member.desc = e.target.innerText.trim();
      save();
    };
    div.querySelector('button[title="Add child"]').onclick = e => {
      e.stopPropagation();
      promptAddChild(member.id);
    };
    if (!isSpouse) div.querySelector('button[title="Add spouse"]').onclick = e => {
      e.stopPropagation();
      addSpouse(member);
    };
    if (member.parentCoupleId) div.querySelector('button[title="Add sibling"]').onclick = e => {
      e.stopPropagation();
      addSibling(member.id);
    };
    div.querySelector('button[title="Remove"]').onclick = e => {
      e.stopPropagation();
      removeMember(member.id);
    };
    return div;
  }
  function promptAddChild(parentId) {
    const memberCouples = couples.filter(c => c.partner1Id === parentId || c.partner2Id === parentId);
    if (memberCouples.length === 0) {
      addChild(null, parentId);
      return;
    }
    if (memberCouples.length === 1) {
      addChild(memberCouples[0].id, parentId);
      return;
    }
    let message = 'Select couple:\n';
    memberCouples.forEach((c, i) => {
      const p1 = findMember(c.partner1Id);
      const p2 = findMember(c.partner2Id);
      message += `${i + 1}: ${p1.name} & ${p2.name}\n`;
    });
    const choice = prompt(message + 'Enter number:');
    const num = Number(choice);
    if (num > 0 && num <= memberCouples.length) addChild(memberCouples[num - 1].id, parentId);
  }
  function addChild(parentCoupleId, singleParentId) {
    const name = prompt("Enter child's name:");
    if (!name) return;
    const child = {
      id: generateId(),
      name: name.trim(),
      desc: '',
      img: '',
      parentCoupleId,
      spouseIds: [],
      spouseOf: null
    };
    family.push(child);
    if (parentCoupleId) {
      const couple = findCouple(parentCoupleId);
      if (couple) couple.childrenIds.push(child.id);
    }
    save();
    render();
  }
  function addSpouse(member) {
    const name = prompt("Enter spouse's name:");
    if (!name) return;
    const spouse = {
      id: generateId(),
      name: name.trim(),
      desc: '',
      img: '',
      spouseIds: [],
      spouseOf: member.id,
      parentCoupleId: null
    };
    family.push(spouse);
    const couple = {
      id: generateId(),
      partner1Id: member.id,
      partner2Id: spouse.id,
      childrenIds: []
    };
    couples.push(couple);
    if (!member.spouseIds) member.spouseIds = [];
    member.spouseIds.push(spouse.id);
    save();
    render();
  }
  function removeMember(id) {
    if (!confirm('Remove this member?')) return;
    family = family.filter(m => m.id !== id);
    family.forEach(m => {
      if (m.spouseIds) m.spouseIds = m.spouseIds.filter(sid => sid !== id);
      if (m.spouseOf === id) m.spouseOf = null;
    });
    const couplesToRemove = couples.filter(c => c.partner1Id === id || c.partner2Id === id);
    couplesToRemove.forEach(c => {
      c.childrenIds.forEach(childId => {
        const child = findMember(childId);
        if (child) child.parentCoupleId = null;
      });
    });
    couples = couples.filter(c => c.partner1Id !== id && c.partner2Id !== id);
    save();
    render();
  }
  function addSibling(memberId) {
    const member = findMember(memberId);
    if (!member) return;
    const parentCoupleId = member.parentCoupleId || null;
    const name = prompt("Enter sibling's name:");
    if (!name) return;
    const sibling = {
      id: generateId(),
      name: name.trim(),
      desc: '',
      img: '',
      parentCoupleId,
      spouseIds: [],
      spouseOf: null
    };
    family.push(sibling);
    if (parentCoupleId) {
      const couple = findCouple(parentCoupleId);
      if (couple) couple.childrenIds.push(sibling.id);
    }
    save();
    render();
  }
  function addRootMember() {
    const name = prompt('Enter root member name:');
    if (!name) return;
    const member = {
      id: generateId(),
      name: name.trim(),
      desc: '',
      img: '',
      spouseIds: [],
      spouseOf: null,
      parentCoupleId: null
    };
    family.push(member);
    save();
    render();
  }
  function clearTree() {
    if (!confirm('Clear entire tree?')) return;
    localStorage.removeItem(STORAGE_KEY);
    family = [];
    couples = [];
    awardsMap = {};
    render();
  }

  // PROFILE MODAL LOGIC
  const modal = document.getElementById('profileModal');
  const profileImg = document.getElementById('profileImg');
  const profileName = document.getElementById('profileName');
  const profileAge = document.getElementById('profileAge');
  const profileDesc = document.getElementById('profileDesc');
  const profileAwards = document.getElementById('profileAwards');
  const profileSpouses = document.getElementById('profileSpouses');
  const profileChildren = document.getElementById('profileChildren');
  const closeBtn = document.getElementById('profileCloseBtn');

  let currentProfileId = null;

  function openProfileModal(memberId) {
  if (!window.isAdmin) {
    alert('Access denied: Admin only.');
    return; // Stop here if not admin
  }

  const member = findMember(memberId);
  if (!member) return;
  currentProfileId = memberId;

  profileImg.src = member.img || 'https://via.placeholder.com/120?text=No+Image';
  profileImg.alt = `Profile photo of ${member.name}`;
  profileName.textContent = member.name || 'Unnamed';

  const profileBorn = document.getElementById('profileBorn');
  profileBorn.value = member.born || '';
  profileDesc.value = member.desc || '';
  profileAwards.value = (awardsMap[memberId] || []).join(', ');

  showProfileSpouses(memberId);

  profileChildren.innerHTML = '';
  let anyChildren = false;
  const memberCouples = couples.filter(c => c.partner1Id === memberId || c.partner2Id === memberId);
  memberCouples.forEach(couple => {
    couple.childrenIds.forEach(childId => {
      const child = findMember(childId);
      if (child) {
        anyChildren = true;
        const div = document.createElement('div');
        div.textContent = child.name || 'Unnamed';
        div.style.cursor = 'pointer';
        div.onclick = () => openProfileModal(child.id);
        profileChildren.appendChild(div);
      }
    });
  });
  if (!anyChildren) profileChildren.textContent = 'None';

  modal.classList.add('active');
}


function uniqueCouples(couples, enableLogging = false) {
  const uniqueSet = new Set();
  const uniqueList = [];

  couples.forEach(couple => {
    // Validate partner IDs
    if (!couple.partner1Id || !couple.partner2Id) {
      if (enableLogging) console.warn('Invalid couple (missing partner IDs):', couple);
      return; // skip invalid couple
    }

    // Normalize IDs (trim spaces if any)
    const p1 = couple.partner1Id.trim();
    const p2 = couple.partner2Id.trim();

    // Build key with a separator unlikely to appear in IDs
    const key = [p1, p2].sort().join('||');

    if (!uniqueSet.has(key)) {
      uniqueSet.add(key);
      uniqueList.push(couple);
      if (enableLogging) console.log(`Adding unique couple key: ${key}`);
    } else {
      if (enableLogging) console.log(`Duplicate couple key skipped: ${key}`);
    }
  });

  return uniqueList;
}
function showProfileSpouses(memberId) {
  profileSpouses.innerHTML = '';

  const filteredCouples = uniqueCouples(couples, true); // true to enable logs
  const memberCouples = filteredCouples.filter(c => c.partner1Id === memberId || c.partner2Id === memberId);

  console.log('Filtered couples for memberId', memberId, ':', memberCouples);

  if (memberCouples.length === 0) {
    profileSpouses.textContent = 'None';
    return;
  }

  const displayedSpouseIds = new Set();

  memberCouples.forEach(couple => {
    const spouseId = (couple.partner1Id === memberId) ? couple.partner2Id : couple.partner1Id;

    if (displayedSpouseIds.has(spouseId)) {
      console.log('Skipping duplicate spouseId:', spouseId);
      return;
    }
    displayedSpouseIds.add(spouseId);

    const spouse = findMember(spouseId);
    if (!spouse) return;

    console.log('Adding spouse to display:', spouseId, spouse.name);

    const div = document.createElement('div');
    div.textContent = spouse.name || 'Unnamed';

    // Make the name clickable
    div.style.cursor = 'pointer';
    div.style.color = 'blue';
    div.style.textDecoration = 'underline';

    //div.onclick = () => openProfileModal(spouse.id);
    div.onclick = () => {
  console.log('Is Admin?', window.isAdmin);
  if (!window.isAdmin) {
    alert('Access denied: Admin only');
    return;
  }
  openProfileModal(spouse.id);
};

    profileSpouses.appendChild(div);
  });
}


//console.log('Couples filtered for member:', memberCouples);
//console.log('Adding spouse:', spouseId);

function closeProfileModal() {
    if (currentProfileId) {
      // Save changes from modal back to member data
      const member = findMember(currentProfileId);
      if (!member) return;
      // Save the born value:
    member.born = profileBorn.value.trim();
    // existing saves like desc, awards...
    member.desc = profileDesc.value.trim();
    awardsMap[currentProfileId] = profileAwards.value.split(',').map(s => s.trim()).filter(s => s.length > 0);
         
      save();
      render();
    }
    modal.classList.remove('active');
    currentProfileId = null;
  }

  closeBtn.onclick = closeProfileModal;
  modal.onclick = e => {
    if (e.target === modal) closeProfileModal();
  };

  window.addEventListener('keydown', e => {
    if (e.key === 'Escape' && modal.classList.contains('active')) {
      closeProfileModal();
    }
  });

  load();
  render();

  // Expose some functions globally for buttons
  window.addRootMember = addRootMember;
  window.clearTree = clearTree;

})();
function updateTime() {
  const now = new Date();
  const options = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
  const timeStr = now.toLocaleTimeString(undefined, options);
  document.getElementById('time').textContent = timeStr;
}
updateTime();
setInterval(updateTime, 1000);
function updateTimeAndDate() {
  const timeEl = document.getElementById('time');
  const dateEl = document.getElementById('date');
  
  const now = new Date();

  // Format time: e.g. 22:45
  const hours = now.getHours().toString().padStart(2, '0');
  const mins = now.getMinutes().toString().padStart(2, '0');
  timeEl.textContent = `${hours}:${mins}`;

  // Format date: Tuesday, June 17th, 2025
  const options = { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' };
  const dateStr = now.toLocaleDateString('en-US', options);
  
  // Add suffix to day (1st, 2nd, 3rd, 4th, etc)
  const day = now.getDate();
  let suffix = 'th';
  if (day === 1 || day === 21 || day === 31) suffix = 'st';
  else if (day === 2 || day === 22) suffix = 'nd';
  else if (day === 3 || day === 23) suffix = 'rd';
  
  // Insert suffix after day number
  const dateWithSuffix = dateStr.replace(day.toString(), day + suffix);

  dateEl.textContent = dateWithSuffix;
}

updateTimeAndDate();
setInterval(updateTimeAndDate, 60000); // update every minute
</script>
<script>
    function adjustBodyPadding() {
      const header = document.getElementById('mainHeader');
      if (header) {
        const headerHeight = header.offsetHeight;
        document.body.style.paddingTop = (headerHeight + 20) + 'px'; // add 20px extra space
      }
    }
  
    window.addEventListener('load', adjustBodyPadding);
    window.addEventListener('resize', adjustBodyPadding);

   
  </script>
  <!-- Button to trigger export -->
<button id="exportFamilyBtn" style="">Export Family JSON</button>

<script>
(() => {
  const STORAGE_KEY = 'familyTreeConnectors';
  let family = [];
  let couples = [];
  let awardsMap = {};

  // Load from localStorage
  function load() {
    const data = localStorage.getItem(STORAGE_KEY);
    if (data) {
      const parsed = JSON.parse(data);
      family = parsed.family || [];
      couples = parsed.couples || [];
      awardsMap = parsed.awardsMap || {};
    }
  }

  // Assign to window object for visibility
  function refreshFamilyData() {
    window.familyData = { family, couples, awardsMap };
  }

  // Export function to download as JSON
  function exportFamilyData() {
    refreshFamilyData(); // Make sure it's fresh
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(window.familyData, null, 2));
    const downloadAnchor = document.createElement('a');
    downloadAnchor.setAttribute("href", dataStr);
    downloadAnchor.setAttribute("download", "familyTreeData.json");
    downloadAnchor.click();
  }

  // Load on start
  load();
  refreshFamilyData();

  // Hook up button
  document.getElementById('exportFamilyBtn').addEventListener('click', exportFamilyData);
})();
</script>

<!-- Add Import Button -->
<input type="file" id="importFile" accept=".json" />
<button onclick="document.getElementById('importFile').click()">Import Family Tree JSON</button>

<script>
document.getElementById('importFile').addEventListener('change', function (event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    try {
      const data = JSON.parse(e.target.result);
      if (!data.family || !data.couples || !data.awardsMap) throw new Error('Invalid file structure');

      // Replace data
      localStorage.setItem('familyTreeConnectors', JSON.stringify(data));
      alert('Family tree data imported! Reloading...');
      location.reload();
    } catch (err) {
      alert('Failed to import: ' + err.message);
    }
  };
  reader.readAsText(file);
});
</script>

<script>
  // Make isAdmin global so other functions can check it
  window.isAdmin = false;

  const ADMIN_PASSWORD = 'Phoenix32@';

  function setEditingEnabled(enabled) {
    document.querySelectorAll('button').forEach(btn => {
      if (btn.id === 'adminBtn') {
        btn.disabled = false;
        btn.style.display = '';
        return;
      }
      btn.disabled = !enabled;
      btn.style.display = enabled ? '' : 'none';
    });

    document.querySelectorAll('[contenteditable]').forEach(elem => {
      elem.contentEditable = enabled;
      if (!enabled) {
        elem.style.border = 'none';
        elem.style.backgroundColor = 'transparent';
      } else {
        elem.style.border = '1px solid #000';
        elem.style.backgroundColor = '#fff';
      }
    });

    window.isAdmin = enabled; // update global flag
  }

  document.getElementById('adminBtn').onclick = () => {
    if (!window.isAdmin) {
      const password = prompt('Enter admin password:');
      if (password === ADMIN_PASSWORD) {
        setEditingEnabled(true);
        document.getElementById('adminBtn').textContent = 'Logout Admin';
      } else {
        alert('Wrong password!');
      }
    } else {
      setEditingEnabled(false);
      document.getElementById('adminBtn').textContent = 'Admin Login';
    }
  };

  /*function openProfileModal(memberId) {
    if (!window.isAdmin) {
      alert('Access denied: Admin only.');
      return;
    }
    // your existing code to open the modal with memberId
    const modal = document.getElementById('profileModal');
    modal.style.display = 'block';

    // also populate modal content based on memberId here...
  }
*/

  function openProfileModal(memberId) {
    console.log('openProfileModal called, isAdmin=', window.isAdmin); // DEBUG

  if (!window.isAdmin) {
    alert('Access denied: Admin only.');
    return; // prevent popup from opening
  }

  const member = findMember(memberId);
  if (!member) return;

  currentProfileId = memberId;

  profileImg.src = member.img || 'https://via.placeholder.com/120?text=No+Image';
  profileImg.alt = `Profile photo of ${member.name}`;
  profileName.textContent = member.name || 'Unnamed';

  const profileBorn = document.getElementById('profileBorn'); 
  profileBorn.value = member.born || '';
  profileDesc.value = member.desc || '';
  profileAwards.value = (awardsMap[memberId] || []).join(', ');

  showProfileSpouses(memberId);

  profileChildren.innerHTML = '';
  let anyChildren = false;
  const memberCouples = couples.filter(c => c.partner1Id === memberId || c.partner2Id === memberId);
  memberCouples.forEach(couple => {
    couple.childrenIds.forEach(childId => {
      const child = findMember(childId);
      if (child) {
        anyChildren = true;
        const div = document.createElement('div');
        div.textContent = child.name || 'Unnamed';
        div.style.cursor = 'pointer';
        div.onclick = () => openProfileModal(child.id);
        profileChildren.appendChild(div);
      }
    });
  });

  modal.style.display = 'block';
}

  // Start in readonly mode (non-admin)
  setEditingEnabled(false);
</script>
<script>
  const ADMIN_PASSWORD = 'Phoenix32@';
  window.isAdmin = false;

  function setEditingEnabled(enabled) {
    window.isAdmin = enabled;

    document.querySelectorAll('button').forEach(btn => {
      if (btn.id === 'adminBtn') return;
      btn.disabled = !enabled;
      btn.style.display = enabled ? '' : 'none';
    });

    document.querySelectorAll('[contenteditable]').forEach(elem => {
      elem.contentEditable = enabled;
      elem.style.border = enabled ? '1px solid #000' : 'none';
      elem.style.backgroundColor = enabled ? '#fff' : 'transparent';
    });
  }

  document.getElementById('adminBtn').onclick = () => {
    if (!window.isAdmin) {
      const password = prompt('Enter admin password:');
      if (password === ADMIN_PASSWORD) {
        setEditingEnabled(true);
        document.getElementById('adminBtn').textContent = 'Logout Admin';
      } else {
        alert('Wrong password!');
      }
    } else {
      setEditingEnabled(false);
      document.getElementById('adminBtn').textContent = 'Admin Login';
    }
  };

  // PROFILE MODAL LOGIC
  const modal = document.getElementById('profileModal');
  const profileImg = document.getElementById('profileImg');
  const profileName = document.getElementById('profileName');
  const profileDesc = document.getElementById('profileDesc');
  const profileAwards = document.getElementById('profileAwards');
  const profileChildren = document.getElementById('profileChildren');
  const closeBtn = document.getElementById('profileCloseBtn');

  let currentProfileId = null;

 /* function openProfileModal(memberId) {
    console.log('openProfileModal called. isAdmin:', window.isAdmin);

    if (!window.isAdmin) {
      alert('Access denied: Admin only.');
      return;
    }

    const member = findMember(memberId);
    if (!member) return;
    currentProfileId = memberId;

    profileImg.src = member.img || 'https://via.placeholder.com/120?text=No+Image';
    profileName.textContent = member.name || 'Unnamed';

    document.getElementById('profileBorn').value = member.born || '';
    profileDesc.value = member.desc || '';
    profileAwards.value = (awardsMap[memberId] || []).join(', ');

    showProfileSpouses(memberId);

    profileChildren.innerHTML = '';
    const memberCouples = couples.filter(c => c.partner1Id === memberId || c.partner2Id === memberId);
    memberCouples.forEach(couple => {
      couple.childrenIds.forEach(childId => {
        const child = findMember(childId);
        if (child) {
          const div = document.createElement('div');
          div.textContent = child.name || 'Unnamed';
          div.style.cursor = 'pointer';
          div.onclick = () => openProfileModal(child.id);
          profileChildren.appendChild(div);
        }
      });
    });

    if (profileChildren.innerHTML === '') profileChildren.textContent = 'None';
    modal.style.display = 'block';
  }

  closeBtn.onclick = () => modal.style.display = 'none';
  window.onclick = (e) => {
    if (e.target === modal) modal.style.display = 'none';
  };

  // Start in readonly mode
  setEditingEnabled(false);*/
</script>


</body>
</html>
